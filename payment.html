<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>Pago - IziInstall</title>
    <script src="https://static.micuentaweb.pe/static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif;
            background-color: #252526;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .kr-embedded {
            background-color: #2D2D30;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin: 0 auto;
        }
        .kr-payment-button {
            background: linear-gradient(135deg, #9B30FF, #FF1493) !important;
            border: none !important;
            padding: 12px 24px !important;
            font-size: 16px !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
        }
        .kr-payment-button:hover {
            opacity: 0.9 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 15px rgba(155, 48, 255, 0.3) !important;
        }
        #debug {
            margin-top: 20px;
            padding: 10px;
            background-color: #1E1E1E;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }
    </style>
</head>
<body>
    <div class='kr-embedded'>
        <div class='kr-pan'></div>
        <div class='kr-expiry'></div>
        <div class='kr-security-code'></div>
        <button class='kr-payment-button'></button>
    </div>
    <div id="debug"></div>

    <script>
        // Funci칩n para mostrar logs
        function log(message, type = 'info') {
            console.log(message);
            const debug = document.getElementById('debug');
            debug.style.display = 'block';
            const color = type === 'error' ? '#FF4444' : '#44FF44';
            debug.innerHTML += `<div style="color: ${color}">[${type.toUpperCase()}] ${JSON.stringify(message, null, 2)}</div>`;
        }

        // Obtener par치metros de la URL
        const urlParams = new URLSearchParams(window.location.search);
        log('Par치metros recibidos:', 'info');
        log(Object.fromEntries(urlParams));
        
        var KR = KR || {};
        
        KR.onLoad = function() {
            log('KR cargado correctamente');
            const config = {
                formToken: null,
                amount: urlParams.get('amount'),
                currency: urlParams.get('currency'),
                orderId: urlParams.get('orderId'),
                'kr-language': urlParams.get('kr-language'),
                'kr-public-key': urlParams.get('kr-public-key'),
                'kr-post-url-success': 'https://dxsystem.github.io/iziInstallWin/verify.html',
                'kr-post-url-refused': 'https://dxsystem.github.io/iziInstallWin/verify.html',
                'kr-post-url-cancel': 'https://dxsystem.github.io/iziInstallWin/verify.html',
                signature: urlParams.get('signature'),
                timestamp: urlParams.get('timestamp'),
                customer: {
                    email: urlParams.get('customer_email'),
                    billingDetails: {
                        firstName: urlParams.get('customer_firstname'),
                        lastName: urlParams.get('customer_lastname'),
                        phoneNumber: urlParams.get('customer_phone'),
                        email: urlParams.get('customer_email')
                    }
                }
            };

            log('Configuraci칩n del formulario:', 'info');
            log(config);

            KR.setFormConfig(config).then(function(v) {
                log('Formulario inicializado correctamente:', 'info');
                log(v);
                if (window.chrome && window.chrome.webview) {
                    window.chrome.webview.postMessage(JSON.stringify({
                        type: 'info',
                        message: 'Formulario inicializado correctamente'
                    }));
                }
            }).catch(function(error) {
                log('Error al inicializar el formulario:', 'error');
                log(error);
                if (window.chrome && window.chrome.webview) {
                    window.chrome.webview.postMessage(JSON.stringify({
                        type: 'error',
                        message: error.message || 'Error desconocido al inicializar el formulario'
                    }));
                }
            });
        };

        KR.onSubmit(function(event) {
            log('Formulario enviado:', 'info');
            log(event);
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage(JSON.stringify({
                    type: 'submit',
                    data: event
                }));
            }
        });

        KR.onError(function(event) {
            log('Error en el formulario:', 'error');
            log(event);
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage(JSON.stringify({
                    type: 'error',
                    message: event.errorMessage || 'Error desconocido en el formulario'
                }));
            }
        });
    </script>
</body>
</html> 